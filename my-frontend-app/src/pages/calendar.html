<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mission Calendar Â· COSMOS</title>
    <link rel="stylesheet" href="../css/cosmic-sidebar.css">
    <link rel="stylesheet" href="../css/styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Space+Grotesk:wght@500;600&display=swap" rel="stylesheet">
    <script src="../js/cosmic-sidebar.js"></script>
    <style>
        /* COSMOS Calendar Theme Variables */
        :root {
            --bg-primary: #0a0f1f;
            --bg-card: #141b2d;
            --bg-calendar: #1a2332;
            --text-primary: #ffffff;
            --text-secondary: #a0aec0;
            --text-muted: #718096;
            --accent-blue: #4299e1;
            --accent-yellow: #ecc94b;
            --accent-red: #f56565;
            --accent-green: #48bb78;
            --accent-purple: #9f7aea;
            --accent-orange: #ed8936;
            --border-color: rgba(255, 255, 255, 0.1);
        }

        body {
            background: var(--bg-primary);
            color: var(--text-primary);
            font-family: 'Inter', sans-serif;
            margin: 0;
            min-height: 100vh;
            position: relative;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: radial-gradient(circle at 50% 50%, rgba(255, 255, 255, 0.05) 1px, transparent 1px);
            background-size: 50px 50px;
            z-index: -1;
        }

        .main-content {
            margin-left: 280px;
            padding: 2rem;
            min-height: 100vh;
            box-sizing: border-box;
        }

        .cosmic-header {
            background: linear-gradient(135deg, var(--bg-card) 0%, #1e2a3e 100%);
            border-radius: 16px;
            padding: 2rem;
            margin-bottom: 2rem;
            position: relative;
            overflow: hidden;
        }

        .cosmic-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, var(--accent-blue), transparent);
        }

        .cosmic-title {
            font-family: 'Space Grotesk', sans-serif;
            font-size: 2.5rem;
            font-weight: 600;
            margin: 0 0 0.5rem 0;
            background: linear-gradient(135deg, var(--text-primary), var(--accent-blue));
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .cosmic-description {
            color: var(--text-secondary);
            font-size: 1.1rem;
            margin: 0;
        }

        .calendar-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .view-controls {
            display: flex;
            gap: 0.5rem;
        }

        .view-btn {
            padding: 0.75rem 1.5rem;
            background: transparent;
            border: 1px solid var(--border-color);
            color: var(--text-secondary);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.875rem;
            font-weight: 500;
        }

        .view-btn:hover {
            border-color: var(--accent-blue);
            color: var(--accent-blue);
            transform: translateY(-1px);
        }

        .view-btn.active {
            background: var(--accent-blue);
            border-color: var(--accent-blue);
            color: white;
        }

        .month-navigation {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .nav-btn {
            width: 40px;
            height: 40px;
            border: 1px solid var(--border-color);
            background: transparent;
            color: var(--text-secondary);
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .nav-btn:hover {
            border-color: var(--accent-blue);
            color: var(--accent-blue);
            transform: translateY(-1px);
        }

        .current-month {
            font-family: 'Space Grotesk', sans-serif;
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--text-primary);
            min-width: 200px;
            text-align: center;
        }

        .calendar-grid {
            background: var(--bg-card);
            border-radius: 16px;
            overflow: hidden;
            border: 1px solid var(--border-color);
        }

        .calendar-header {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            background: var(--bg-calendar);
            border-bottom: 1px solid var(--border-color);
        }

        .day-header {
            padding: 1rem;
            text-align: center;
            font-weight: 600;
            color: var(--text-secondary);
            font-size: 0.875rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .calendar-body {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
        }

        .calendar-day {
            min-height: 120px;
            border-right: 1px solid var(--border-color);
            border-bottom: 1px solid var(--border-color);
            padding: 0.75rem;
            position: relative;
            background: var(--bg-card);
            transition: all 0.3s ease;
        }

        .calendar-day.week-view {
            min-height: 200px;
            padding: 1rem;
        }

        .calendar-day:hover {
            background: rgba(66, 153, 225, 0.05);
        }

        .calendar-day.other-month {
            color: var(--text-muted);
            background: rgba(0, 0, 0, 0.2);
        }

        .calendar-day.today {
            background: rgba(66, 153, 225, 0.1);
            border: 2px solid var(--accent-blue);
        }

        .calendar-day.has-tasks {
            background: rgba(159, 122, 234, 0.05);
        }

        .day-number {
            font-weight: 600;
            font-size: 0.875rem;
            margin-bottom: 0.5rem;
            color: var(--text-primary);
        }

        .week-view .day-number {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 1rem;
        }

        .day-name {
            font-size: 0.75rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 0.25rem;
        }

        .day-date {
            font-size: 1.125rem;
            font-weight: 700;
            color: var(--text-primary);
        }

        .today .day-number {
            color: var(--accent-blue);
            font-weight: 700;
        }

        .today .day-name {
            color: var(--accent-blue);
        }

        .today .day-date {
            color: var(--accent-blue);
        }

        .task-item {
            background: var(--bg-calendar);
            border-radius: 4px;
            padding: 0.25rem 0.5rem;
            margin-bottom: 0.25rem;
            font-size: 0.75rem;
            border-left: 3px solid;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .task-item:hover {
            transform: translateX(2px);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
        }

        .task-item.priority-high { border-left-color: var(--accent-red); }
        .task-item.priority-medium { border-left-color: var(--accent-yellow); }
        .task-item.priority-low { border-left-color: var(--accent-green); }

        .task-item.module-demand { background: rgba(66, 153, 225, 0.1); }
        .task-item.module-fulfillment { background: rgba(72, 187, 120, 0.1); }
        .task-item.module-inventory { background: rgba(237, 137, 54, 0.1); }
        .task-item.module-alerts { background: rgba(245, 101, 101, 0.1); }

        .task-title {
            color: var(--text-primary);
            font-weight: 500;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            flex: 1;
        }

        .task-priority-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-left: 0.25rem;
        }

        .priority-indicator-high { background: var(--accent-red); }
        .priority-indicator-medium { background: var(--accent-yellow); }
        .priority-indicator-low { background: var(--accent-green); }

        .workload-indicator {
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            border: 2px solid var(--bg-card);
        }

        .workload-light { background: var(--accent-green); }
        .workload-moderate { background: var(--accent-yellow); }
        .workload-heavy { background: var(--accent-red); }

        .unscheduled-tasks {
            background: var(--bg-card);
            border-radius: 16px;
            padding: 1.5rem;
            margin-top: 2rem;
            border: 1px solid var(--border-color);
        }

        .unscheduled-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .unscheduled-title {
            font-family: 'Space Grotesk', sans-serif;
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--text-primary);
            margin: 0;
        }

        .task-count {
            background: var(--accent-red);
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .unscheduled-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1rem;
        }

        .unscheduled-task {
            background: var(--bg-calendar);
            border-radius: 8px;
            padding: 1rem;
            border-left: 4px solid;
            cursor: grab;
            transition: all 0.3s ease;
        }

        .unscheduled-task:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .unscheduled-task.dragging {
            opacity: 0.5;
            transform: rotate(3deg);
            cursor: grabbing;
        }

        .unscheduled-task.priority-high { border-left-color: var(--accent-red); }
        .unscheduled-task.priority-medium { border-left-color: var(--accent-yellow); }
        .unscheduled-task.priority-low { border-left-color: var(--accent-green); }

        .task-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 0.5rem;
        }

        .task-main-title {
            font-weight: 600;
            color: var(--text-primary);
            margin: 0;
            font-size: 0.875rem;
        }

        .task-module-badge {
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: 500;
            text-transform: uppercase;
        }

        .module-demand { background: rgba(66, 153, 225, 0.2); color: var(--accent-blue); }
        .module-fulfillment { background: rgba(72, 187, 120, 0.2); color: var(--accent-green); }
        .module-inventory { background: rgba(237, 137, 54, 0.2); color: var(--accent-orange); }
        .module-alerts { background: rgba(245, 101, 101, 0.2); color: var(--accent-red); }

        .task-description {
            color: var(--text-secondary);
            font-size: 0.75rem;
            margin: 0.5rem 0;
            line-height: 1.4;
        }

        .task-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 0.75rem;
            padding-top: 0.75rem;
            border-top: 1px solid var(--border-color);
        }

        .due-date {
            font-size: 0.75rem;
            color: var(--text-muted);
        }

        .due-date.overdue {
            color: var(--accent-red);
            font-weight: 600;
        }

        .due-date.due-soon {
            color: var(--accent-yellow);
            font-weight: 600;
        }

        .calendar-day.drop-zone {
            background: rgba(66, 153, 225, 0.1);
            border: 2px dashed var(--accent-blue);
        }

        .stats-bar {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 1rem;
            flex: 1;
            border: 1px solid var(--border-color);
            text-align: center;
        }

        .stat-number {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--accent-blue);
            display: block;
        }

        .stat-label {
            font-size: 0.75rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        @media (max-width: 768px) {
            .main-content {
                margin-left: 0;
                padding: 1rem;
            }
            
            .calendar-controls {
                flex-direction: column;
                align-items: stretch;
            }
            
            .calendar-day {
                min-height: 80px;
                padding: 0.5rem;
            }
            
            .unscheduled-list {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>


    <div class="main-content">
        <div class="cosmic-header">
            <h1 class="cosmic-title">Mission Calendar</h1>
            <p class="cosmic-description">Schedule and track your mission-critical tasks across time</p>
        </div>

        <div class="stats-bar">
            <div class="stat-card">
                <span class="stat-number" id="totalTasks">0</span>
                <span class="stat-label">Total Tasks</span>
            </div>
            <div class="stat-card">
                <span class="stat-number" id="scheduledTasks">0</span>
                <span class="stat-label">Scheduled</span>
            </div>
            <div class="stat-card">
                <span class="stat-number" id="unscheduledTasks">0</span>
                <span class="stat-label">Unscheduled</span>
            </div>
            <div class="stat-card">
                <span class="stat-number" id="overdueTasks">0</span>
                <span class="stat-label">Overdue</span>
            </div>
        </div>

        <div class="calendar-controls">
            <div class="view-controls">
                <button class="view-btn active" data-view="month">Month</button>
                <button class="view-btn" data-view="week">Week</button>
            </div>
            <div class="month-navigation">
                <button class="nav-btn" id="prevMonth">â¹</button>
                <span class="current-month" id="currentMonth">August 2025</span>
                <button class="nav-btn" id="nextMonth">âº</button>
            </div>
        </div>

        <div class="calendar-grid">
            <div class="calendar-header">
                <div class="day-header">Sun</div>
                <div class="day-header">Mon</div>
                <div class="day-header">Tue</div>
                <div class="day-header">Wed</div>
                <div class="day-header">Thu</div>
                <div class="day-header">Fri</div>
                <div class="day-header">Sat</div>
            </div>
            <div class="calendar-body" id="calendarBody">
                <!-- Calendar days will be generated by JavaScript -->
            </div>
        </div>

        <div class="unscheduled-tasks">
            <div class="unscheduled-header">
                <h3 class="unscheduled-title">Unscheduled Tasks</h3>
                <span class="task-count" id="unscheduledCount">0</span>
            </div>
            <div class="unscheduled-list" id="unscheduledList">
                <!-- Unscheduled tasks will be populated by JavaScript -->
            </div>
        </div>
    </div>

    <script src="../js/main.js"></script>
    <script>
        // Sample task data - in a real app, this would come from your API/backend
        // This mirrors the complete structure from todo-board.html (21 tasks total)
        let tasks = [
            // Demand Forecasting Tasks
            {
                id: 1,
                title: "Update demand forecast model",
                description: "Incorporate latest sales data into Q3 forecasting model",
                module: "demand",
                priority: "high",
                status: "todo",
                dueDate: "2025-08-10",
                createdDate: "2025-08-06",
                scheduledDate: null
            },
            {
                id: 5,
                title: "Weekly forecast analysis",
                description: "Generate automated weekly demand analysis report",
                module: "demand",
                priority: "low",
                status: "completed",
                dueDate: "2025-08-05",
                createdDate: "2025-08-01",
                scheduledDate: "2025-08-05"
            },
            {
                id: 6,
                title: "Seasonal trend analysis",
                description: "Analyze Q4 holiday patterns for 2025 forecasting",
                module: "demand",
                priority: "medium",
                status: "progress",
                dueDate: "2025-08-15",
                createdDate: "2025-08-03",
                scheduledDate: "2025-08-12"
            },
            {
                id: 7,
                title: "Model accuracy validation",
                description: "Compare predicted vs actual sales for July 2025",
                module: "demand",
                priority: "high",
                status: "todo",
                dueDate: "2025-08-08",
                createdDate: "2025-08-06",
                scheduledDate: null
            },
            {
                id: 8,
                title: "Holiday impact assessment",
                description: "Evaluate Independence Day sales impact on forecast model",
                module: "demand",
                priority: "medium",
                status: "completed",
                dueDate: "2025-08-07",
                createdDate: "2025-08-04",
                scheduledDate: "2025-08-07"
            },
            
            // Smart Inventory Tasks
            {
                id: 3,
                title: "Critical inventory rebalancing",
                description: "Rebalance stock levels for products below safety threshold",
                module: "inventory",
                priority: "high",
                status: "todo",
                dueDate: "2025-08-07",
                createdDate: "2025-08-06",
                scheduledDate: "2025-08-07"
            },
            {
                id: 9,
                title: "Update reorder points",
                description: "Recalculate reorder points based on Q3 demand patterns",
                module: "inventory",
                priority: "medium",
                status: "progress",
                dueDate: "2025-08-12",
                createdDate: "2025-08-04",
                scheduledDate: "2025-08-11"
            },
            {
                id: 10,
                title: "Vendor performance review",
                description: "Assess AromaTech delivery times and adjust lead time calculations",
                module: "inventory",
                priority: "low",
                status: "completed",
                dueDate: "2025-08-05",
                createdDate: "2025-08-01",
                scheduledDate: "2025-08-05"
            },
            {
                id: 11,
                title: "SKU rationalization analysis",
                description: "Identify slow-moving products for potential discontinuation",
                module: "inventory",
                priority: "medium",
                status: "todo",
                dueDate: "2025-08-15",
                createdDate: "2025-08-06",
                scheduledDate: null
            },
            {
                id: 12,
                title: "ABC classification update",
                description: "Reclassify inventory based on value and velocity analysis",
                module: "inventory",
                priority: "high",
                status: "progress",
                dueDate: "2025-08-09",
                createdDate: "2025-08-05",
                scheduledDate: "2025-08-08"
            },
            {
                id: 13,
                title: "Safety stock optimization",
                description: "Optimize safety stock levels for Manhattan Eau de Parfum",
                module: "inventory",
                priority: "medium",
                status: "completed",
                dueDate: "2025-08-04",
                createdDate: "2025-08-02",
                scheduledDate: "2025-08-04"
            },
            
            // Fulfillment Tasks
            {
                id: 2,
                title: "Process pending shipments",
                description: "Review and approve 15 pending shipment orders",
                module: "fulfillment",
                priority: "medium",
                status: "progress",
                dueDate: "2025-08-08",
                createdDate: "2025-08-05",
                scheduledDate: "2025-08-08"
            },
            {
                id: 14,
                title: "Optimize delivery routes",
                description: "Analyze and optimize last-mile delivery routes for Mexico City",
                module: "fulfillment",
                priority: "low",
                status: "todo",
                dueDate: "2025-08-14",
                createdDate: "2025-08-06",
                scheduledDate: null
            },
            {
                id: 15,
                title: "Carrier performance review",
                description: "Evaluate shipping partner performance and costs",
                module: "fulfillment",
                priority: "medium",
                status: "completed",
                dueDate: "2025-08-03",
                createdDate: "2025-07-30",
                scheduledDate: "2025-08-03"
            },
            {
                id: 16,
                title: "Update packaging standards",
                description: "Implement new eco-friendly packaging requirements",
                module: "fulfillment",
                priority: "high",
                status: "progress",
                dueDate: "2025-08-11",
                createdDate: "2025-08-04",
                scheduledDate: "2025-08-10"
            },
            {
                id: 17,
                title: "Return processing automation",
                description: "Set up automated return processing workflow",
                module: "fulfillment",
                priority: "medium",
                status: "todo",
                dueDate: "2025-08-18",
                createdDate: "2025-08-06",
                scheduledDate: null
            },
            
            // Alarms & Alerts Tasks
            {
                id: 4,
                title: "Resolve system alert",
                description: "Database connection timeout - investigate and fix",
                module: "alerts",
                priority: "high",
                status: "progress",
                dueDate: "2025-08-06",
                createdDate: "2025-08-06",
                scheduledDate: "2025-08-06"
            },
            {
                id: 18,
                title: "Configure low stock alerts",
                description: "Set up automated alerts for products approaching reorder points",
                module: "alerts",
                priority: "high",
                status: "todo",
                dueDate: "2025-08-09",
                createdDate: "2025-08-06",
                scheduledDate: null
            },
            {
                id: 19,
                title: "System health monitoring",
                description: "Implement comprehensive system health monitoring dashboard",
                module: "alerts",
                priority: "medium",
                status: "progress",
                dueDate: "2025-08-16",
                createdDate: "2025-08-05",
                scheduledDate: "2025-08-14"
            },
            {
                id: 20,
                title: "Alert notification cleanup",
                description: "Remove obsolete alert rules and optimize notification frequency",
                module: "alerts",
                priority: "low",
                status: "completed",
                dueDate: "2025-08-02",
                createdDate: "2025-07-28",
                scheduledDate: "2025-08-02"
            },
            {
                id: 21,
                title: "Performance threshold tuning",
                description: "Adjust performance alert thresholds based on recent data",
                module: "alerts",
                priority: "medium",
                status: "todo",
                dueDate: "2025-08-13",
                createdDate: "2025-08-06",
                scheduledDate: null
            }
        ];

        let currentDate = new Date();
        let currentView = 'month';

        // Initialize calendar
        document.addEventListener('DOMContentLoaded', function() {
            renderCalendar();
            renderUnscheduledTasks();
            updateStats();
            setupEventListeners();
        });

        function setupEventListeners() {
            // Month navigation
            document.getElementById('prevMonth').addEventListener('click', () => {
                if (currentView === 'month') {
                    currentDate.setMonth(currentDate.getMonth() - 1);
                } else {
                    // In week view, go back one week
                    currentDate.setDate(currentDate.getDate() - 7);
                }
                renderCalendar();
            });

            document.getElementById('nextMonth').addEventListener('click', () => {
                if (currentView === 'month') {
                    currentDate.setMonth(currentDate.getMonth() + 1);
                } else {
                    // In week view, go forward one week
                    currentDate.setDate(currentDate.getDate() + 7);
                }
                renderCalendar();
            });

            // View controls
            document.querySelectorAll('.view-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    document.querySelectorAll('.view-btn').forEach(b => b.classList.remove('active'));
                    e.target.classList.add('active');
                    currentView = e.target.dataset.view;
                    renderCalendar();
                });
            });
        }

        function renderCalendar() {
            const calendarBody = document.getElementById('calendarBody');
            const currentMonth = document.getElementById('currentMonth');
            
            // Clear calendar
            calendarBody.innerHTML = '';

            if (currentView === 'month') {
                renderMonthView(calendarBody, currentMonth);
            } else if (currentView === 'week') {
                renderWeekView(calendarBody, currentMonth);
            }

            setupDragAndDrop();
        }

        function renderMonthView(calendarBody, currentMonth) {
            // Update month display
            const monthNames = ["January", "February", "March", "April", "May", "June",
                "July", "August", "September", "October", "November", "December"];
            currentMonth.textContent = `${monthNames[currentDate.getMonth()]} ${currentDate.getFullYear()}`;

            // Get first day of month and number of days
            const firstDay = new Date(currentDate.getFullYear(), currentDate.getMonth(), 1);
            const lastDay = new Date(currentDate.getFullYear(), currentDate.getMonth() + 1, 0);
            const startDate = new Date(firstDay);
            startDate.setDate(startDate.getDate() - firstDay.getDay());

            // Generate calendar days (6 weeks)
            for (let week = 0; week < 6; week++) {
                for (let day = 0; day < 7; day++) {
                    const cellDate = new Date(startDate);
                    cellDate.setDate(startDate.getDate() + (week * 7) + day);
                    
                    const dayElement = createDayElement(cellDate, firstDay.getMonth(), 'month');
                    calendarBody.appendChild(dayElement);
                }
            }
        }

        function renderWeekView(calendarBody, currentMonth) {
            // Get the week containing the current date
            const startOfWeek = new Date(currentDate);
            startOfWeek.setDate(currentDate.getDate() - currentDate.getDay());
            
            const endOfWeek = new Date(startOfWeek);
            endOfWeek.setDate(startOfWeek.getDate() + 6);

            // Update display to show week range
            const monthNames = ["January", "February", "March", "April", "May", "June",
                "July", "August", "September", "October", "November", "December"];
            
            if (startOfWeek.getMonth() === endOfWeek.getMonth()) {
                currentMonth.textContent = `${monthNames[startOfWeek.getMonth()]} ${startOfWeek.getDate()}-${endOfWeek.getDate()}, ${startOfWeek.getFullYear()}`;
            } else {
                currentMonth.textContent = `${monthNames[startOfWeek.getMonth()]} ${startOfWeek.getDate()} - ${monthNames[endOfWeek.getMonth()]} ${endOfWeek.getDate()}, ${startOfWeek.getFullYear()}`;
            }

            // Generate 7 days for the week
            for (let day = 0; day < 7; day++) {
                const cellDate = new Date(startOfWeek);
                cellDate.setDate(startOfWeek.getDate() + day);
                
                const dayElement = createDayElement(cellDate, currentDate.getMonth(), 'week');
                calendarBody.appendChild(dayElement);
            }
        }

        function createDayElement(date, currentMonth, viewType = 'month') {
            const dayElement = document.createElement('div');
            dayElement.className = 'calendar-day';
            dayElement.dataset.date = date.toISOString().split('T')[0];

            // Add classes for styling based on view type
            if (viewType === 'week') {
                dayElement.classList.add('week-view');
            } else if (date.getMonth() !== currentMonth) {
                dayElement.classList.add('other-month');
            }
            
            if (isToday(date)) {
                dayElement.classList.add('today');
            }

            // Get tasks for this day
            const dayTasks = getTasksForDay(date);
            if (dayTasks.length > 0) {
                dayElement.classList.add('has-tasks');
            }

            // Create day content
            const dayNumber = document.createElement('div');
            dayNumber.className = 'day-number';
            
            if (viewType === 'week') {
                // Show day name and date for week view
                const dayNames = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
                dayNumber.innerHTML = `<span class="day-name">${dayNames[date.getDay()]}</span><span class="day-date">${date.getDate()}</span>`;
            } else {
                dayNumber.textContent = date.getDate();
            }
            
            dayElement.appendChild(dayNumber);

            // Add workload indicator
            const workloadLevel = getWorkloadLevel(dayTasks);
            if (workloadLevel) {
                const workloadIndicator = document.createElement('div');
                workloadIndicator.className = `workload-indicator workload-${workloadLevel}`;
                dayElement.appendChild(workloadIndicator);
            }

            // Adjust task display based on view
            const maxTasks = viewType === 'week' ? 6 : 3;
            
            // Add tasks
            dayTasks.slice(0, maxTasks).forEach(task => {
                const taskElement = createTaskElement(task, viewType);
                dayElement.appendChild(taskElement);
            });

            // Show overflow indicator
            if (dayTasks.length > maxTasks) {
                const overflow = document.createElement('div');
                overflow.className = 'task-item';
                overflow.style.background = 'rgba(255, 255, 255, 0.1)';
                overflow.innerHTML = `<span class="task-title">+${dayTasks.length - maxTasks} more</span>`;
                dayElement.appendChild(overflow);
            }

            return dayElement;
        }

        function createTaskElement(task, viewType = 'month') {
            const taskElement = document.createElement('div');
            taskElement.className = `task-item priority-${task.priority} module-${task.module}`;
            taskElement.dataset.taskId = task.id;

            const title = document.createElement('span');
            title.className = 'task-title';
            
            // Show more/less text based on view
            if (viewType === 'week') {
                title.textContent = task.title; // Full title in week view
            } else {
                // Truncate for month view
                title.textContent = task.title.length > 25 ? task.title.substring(0, 25) + '...' : task.title;
            }

            const priorityIndicator = document.createElement('div');
            priorityIndicator.className = `task-priority-indicator priority-indicator-${task.priority}`;

            taskElement.appendChild(title);
            taskElement.appendChild(priorityIndicator);

            // Add click handler for task details
            taskElement.addEventListener('click', () => showTaskDetails(task));

            return taskElement;
        }

        function renderUnscheduledTasks() {
            const unscheduledList = document.getElementById('unscheduledList');
            const unscheduledCount = document.getElementById('unscheduledCount');
            
            const unscheduled = tasks.filter(task => !task.scheduledDate && task.status !== 'completed');
            
            unscheduledList.innerHTML = '';
            unscheduledCount.textContent = unscheduled.length;

            unscheduled.forEach(task => {
                const taskElement = createUnscheduledTaskElement(task);
                unscheduledList.appendChild(taskElement);
            });
        }

        function createUnscheduledTaskElement(task) {
            const taskElement = document.createElement('div');
            taskElement.className = `unscheduled-task priority-${task.priority}`;
            taskElement.draggable = true;
            taskElement.dataset.taskId = task.id;

            const isOverdue = new Date(task.dueDate) < new Date();
            const isDueSoon = new Date(task.dueDate) <= new Date(Date.now() + 2 * 24 * 60 * 60 * 1000);

            taskElement.innerHTML = `
                <div class="task-header">
                    <h4 class="task-main-title">${task.title}</h4>
                    <span class="task-module-badge module-${task.module}">${task.module}</span>
                </div>
                <p class="task-description">${task.description}</p>
                <div class="task-meta">
                    <span class="due-date ${isOverdue ? 'overdue' : isDueSoon ? 'due-soon' : ''}">
                        Due: ${formatDate(task.dueDate)}
                    </span>
                    <span class="task-priority-indicator priority-indicator-${task.priority}"></span>
                </div>
            `;

            return taskElement;
        }

        function setupDragAndDrop() {
            // Make unscheduled tasks draggable
            document.querySelectorAll('.unscheduled-task').forEach(task => {
                task.addEventListener('dragstart', handleDragStart);
                task.addEventListener('dragend', handleDragEnd);
            });

            // Make calendar days drop zones
            document.querySelectorAll('.calendar-day').forEach(day => {
                day.addEventListener('dragover', handleDragOver);
                day.addEventListener('drop', handleDrop);
                day.addEventListener('dragenter', handleDragEnter);
                day.addEventListener('dragleave', handleDragLeave);
            });
        }

        function handleDragStart(e) {
            e.dataTransfer.setData('text/plain', e.target.dataset.taskId);
            e.target.classList.add('dragging');
        }

        function handleDragEnd(e) {
            e.target.classList.remove('dragging');
        }

        function handleDragOver(e) {
            e.preventDefault();
        }

        function handleDragEnter(e) {
            e.preventDefault();
            e.target.closest('.calendar-day').classList.add('drop-zone');
        }

        function handleDragLeave(e) {
            if (!e.target.closest('.calendar-day').contains(e.relatedTarget)) {
                e.target.closest('.calendar-day').classList.remove('drop-zone');
            }
        }

        function handleDrop(e) {
            e.preventDefault();
            const taskId = parseInt(e.dataTransfer.getData('text/plain'));
            const targetDay = e.target.closest('.calendar-day');
            const targetDate = targetDay.dataset.date;
            
            targetDay.classList.remove('drop-zone');
            
            // Update task with scheduled date
            const task = tasks.find(t => t.id === taskId);
            if (task) {
                task.scheduledDate = targetDate;
                renderCalendar();
                renderUnscheduledTasks();
                updateStats();
                
                // Show success message
                showNotification(`Task "${task.title}" scheduled for ${formatDate(targetDate)}`, 'success');
            }
        }

        function getTasksForDay(date) {
            const dateString = date.toISOString().split('T')[0];
            return tasks.filter(task => task.scheduledDate === dateString);
        }

        function getWorkloadLevel(tasks) {
            const taskCount = tasks.length;
            const highPriorityCount = tasks.filter(t => t.priority === 'high').length;
            
            if (highPriorityCount >= 2 || taskCount >= 4) return 'heavy';
            if (highPriorityCount >= 1 || taskCount >= 2) return 'moderate';
            if (taskCount >= 1) return 'light';
            return null;
        }

        function updateStats() {
            const total = tasks.filter(t => t.status !== 'completed').length;
            const scheduled = tasks.filter(t => t.scheduledDate && t.status !== 'completed').length;
            const unscheduled = total - scheduled;
            const overdue = tasks.filter(t => 
                new Date(t.dueDate) < new Date() && t.status !== 'completed'
            ).length;

            document.getElementById('totalTasks').textContent = total;
            document.getElementById('scheduledTasks').textContent = scheduled;
            document.getElementById('unscheduledTasks').textContent = unscheduled;
            document.getElementById('overdueTasks').textContent = overdue;
        }

        function showTaskDetails(task) {
            // In a real app, this would open a modal or sidebar with full task details
            alert(`Task: ${task.title}\n\nDescription: ${task.description}\n\nModule: ${task.module}\nPriority: ${task.priority}\nDue: ${task.dueDate}\nStatus: ${task.status}`);
        }

        function showNotification(message, type = 'info') {
            // Simple notification - in a real app, you'd want a proper notification system
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: ${type === 'success' ? 'var(--accent-green)' : 'var(--accent-blue)'};
                color: white;
                padding: 1rem;
                border-radius: 8px;
                z-index: 1000;
                opacity: 0;
                transition: opacity 0.3s ease;
            `;
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => notification.style.opacity = '1', 100);
            setTimeout(() => {
                notification.style.opacity = '0';
                setTimeout(() => document.body.removeChild(notification), 300);
            }, 3000);
        }

        function isToday(date) {
            const today = new Date();
            return date.toDateString() === today.toDateString();
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('en-US', { 
                month: 'short', 
                day: 'numeric' 
            });
        }
    </script>
</body>
</html>